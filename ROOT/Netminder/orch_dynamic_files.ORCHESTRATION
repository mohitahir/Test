{"job":{"components":{"329752":{"id":329752,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-592,"y":-48,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[351102,454634],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"330467":{"id":330467,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-448,"y":-48,"width":32,"height":32,"inputConnectorIDs":[351102],"outputSuccessConnectorIDs":[455141],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[430668],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"var_file_header_row"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nimport codecs\nimport boto3\nimport csv\n\n\ns3 = boto3.resource('s3')#, aws_access_key_id=aws_key, aws_secret_access_key=aws_secret)\n\nline_stream = codecs.getreader(\"utf-8\")\n\nbucket = '${env_var_s3_ddpa_bkt}'\n\nfile_name = '${input_file}'\n\n \ns3_obj = s3.Object(bucket, file_name)\nfirst_line = line_stream(s3_obj.get()['Body']).readline()\n\n\ncontext.updateVariable('var_file_header_row', first_line)\n\n\ncsv_content = csv.reader(first_line.splitlines())\n\n#row = csv.reader(first_line.splitlines())\n\n\ncol_names = []\n\nfor row in csv_content:\n for col in row:\n  if col != None and col != '':\n   col_names.append([col])\n  \n\n#for col_name in row:\n#  if col_name != None and col_name != '':\n#   col_names.append([col_name])\n \ncontext.updateGridVariable('ColumnsGrid', col_names)\n\nlistActual=(var_file_header_row.split('|'))\n\n\n#print (var_file_header_row)\n\nlistExpected = [\"column1\"]\n\nprint (listActual)\n\ntemp = set(listExpected)  \nlistMatched = [val for i, val in enumerate(listActual) if val in temp] \nlistExtras = [val for i, val in enumerate(listActual) if val not in temp]\nprint(\"Extra columns:\",listExtras)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 2"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"330475":{"id":330475,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":-336,"y":-48,"width":32,"height":32,"inputConnectorIDs":[430668],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[452428],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Query Result To Scalar 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select LISTAGG(  DISTINCT column_name, '|' )\nfrom dev_matillion_poc.information_schema.columns c1\nwhere table_name = 'src_netminder'\norder by ordinal_position"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"var_table_header_row"},"2":{"slot":2,"type":"STRING","value":"LISTAGG(  DISTINCT COLUMN_NAME, '|' )"}}}},"visible":true},"4":{"slot":4,"name":"","elements":{},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"426319":{"id":426319,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-224,"y":-48,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"trf_extract_hdr_row 0"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"trf_extract_hdr_row"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"var_trf_file_header_row"},"2":{"slot":2,"type":"STRING","value":"${var_file_header_row}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"var_trf_table_header_row"},"2":{"slot":2,"type":"STRING","value":"${var_table_header_row}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[453638]},"452431":{"id":452431,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":-424773870,"x":-224,"y":-48,"width":32,"height":16,"inputConnectorIDs":[452428],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Grid Iterator 0"}}}},"visible":true},"3":{"slot":3,"name":"Grid Variable","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ColumnsGrid"}}}},"visible":true},"4":{"slot":4,"name":"Grid Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Column_Name"},"2":{"slot":2,"type":"STRING","value":"var_file_header_row"}}}},"visible":true},"5":{"slot":5,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"6":{"slot":6,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[453638],"inputIterationConnectorIDs":[]},"454627":{"id":454627,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-448,"y":-128,"width":32,"height":32,"inputConnectorIDs":[454634],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"var_file_header_row"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of Python Script 0"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\nimport codecs\nimport boto3\nimport csv\n\n\ns3 = boto3.resource('s3')#, aws_access_key_id=aws_key, aws_secret_access_key=aws_secret)\n\nline_stream = codecs.getreader(\"utf-8\")\n\nbucket = '${env_var_s3_ddpa_bkt}'\n\nfile_name = '${input_file}'\n\n \ns3_obj = s3.Object(bucket, file_name)\nfirst_line = line_stream(s3_obj.get()['Body']).readline()\n\n\ncontext.updateVariable('var_file_header_row', first_line)\n\n\ncsv_content = csv.reader(first_line.splitlines())\n\n#row = csv.reader(first_line.splitlines())\n\n\ncol_names = []\n\nfor row in csv_content:\n for col in row:\n  if col != None and col != '':\n   col_names.append([col])\n  \n\n#for col_name in row:\n#  if col_name != None and col_name != '':\n#   col_names.append([col_name])\n \ncontext.updateGridVariable('ColumnsGrid', col_names)\n\nlistActual=(var_file_header_row.split('|'))\n\n\n#print (var_file_header_row)\n\nlistExpected = [\"column1\"]\n\nprint (listActual)\n\ntemp = set(listExpected)  \nlistMatched = [val for i, val in enumerate(listActual) if val in temp] \nlistExtras = [val for i, val in enumerate(listActual) if val not in temp]\nprint(\"Extra columns:\",listExtras)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 2"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"455140":{"id":455140,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1611478312,"x":-384,"y":96,"width":32,"height":32,"inputConnectorIDs":[455141],"outputSuccessConnectorIDs":[455211],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create Table 0"}}}},"visible":true},"2":{"slot":2,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"3":{"slot":3,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"4":{"slot":4,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"src_netminder"}}}},"visible":true},"5":{"slot":5,"name":"Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"GRID","value":"ColumnsGrid"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"GRID","value":"Column_Name"},"2":{"slot":2,"type":"GRID","value":"Column_Name"},"3":{"slot":3,"type":"GRID","value":"Column_Name"},"4":{"slot":4,"type":"GRID","value":"Column_Name"},"5":{"slot":5,"type":"GRID","value":"Column_Name"},"6":{"slot":6,"type":"GRID","value":"Column_Name"},"7":{"slot":7,"type":"GRID","value":"Column_Name"}}}},"visible":true},"6":{"slot":6,"name":"Create/Replace","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Replace"}}}},"visible":true},"7":{"slot":7,"name":"Clustering Keys","elements":{},"visible":true},"8":{"slot":8,"name":"Data Retention Time in Days","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true},"9":{"slot":9,"name":"Comment","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"11":{"slot":11,"name":"Primary Keys","elements":{},"visible":true},"12":{"slot":12,"name":"Table Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Permanent"}}}},"visible":true},"13":{"slot":13,"name":"Default DDL Collation","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"455210":{"id":455210,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-240,"y":128,"width":32,"height":32,"inputConnectorIDs":[455211],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL Script 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"455141":{"id":455141,"sourceID":330467,"targetID":455140},"455211":{"id":455211,"sourceID":455140,"targetID":455210}},"failureConnectors":{},"unconditionalConnectors":{"351102":{"id":351102,"sourceID":329752,"targetID":330467},"430668":{"id":430668,"sourceID":330467,"targetID":330475},"452428":{"id":452428,"sourceID":330475,"targetID":452431},"454634":{"id":454634,"sourceID":329752,"targetID":454627}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"453638":{"id":453638,"sourceID":452431,"targetID":426319}},"noteConnectors":{},"notes":{},"variables":{"var_buffer_bytes":{"definition":{"name":"var_buffer_bytes","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0001-2000"},"var_byte_sample":{"definition":{"name":"var_byte_sample","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"var_file_header_row":{"definition":{"name":"var_file_header_row","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"var_table_header_row":{"definition":{"name":"var_table_header_row","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{"ColumnsGrid":{"definition":{"name":"ColumnsGrid","scope":"BRANCH","definitions":[{"name":"Column_Name","type":"TEXT"}],"description":"","visibility":"PUBLIC"},"values":[]}}},"info":{"name":"orch_dynamic_files","description":null,"type":"ORCHESTRATION","tag":"e5975c1d-3788-4a57-b614-52d45424fca4"}}